<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>é©¬æ¥è¯­å­¦ä¹ æ¸¸æˆ</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #1a1a1a;
            font-family: Arial, sans-serif;
            color: white;
        }
        .game-container {
            position: relative;
            height: 100vh;
            width: 100%;
            overflow: hidden;
        }
        .status-bar {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            background-color: #333;
            z-index: 100;
        }
        .status-left {
            display: flex;
            gap: 2rem;
        }
        .question {
            position: absolute;
            top: 80px;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            background-color: rgba(51, 51, 51, 0.8);
            padding: 1rem;
            z-index: 90;
        }
        .zombie {
            position: absolute;
            cursor: pointer;
            transition: transform 0.2s;
            text-align: center;
        }
        .zombie:hover {
            transform: scale(1.1);
        }
        .zombie-word {
            background-color: #2b7a2b;
            padding: 0.5rem;
            border-radius: 0.5rem;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .zombie-emoji {
            font-size: 2.5rem;
            margin-top: 0.5rem;
        }
        .game-over {
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .game-over-content {
            background-color: white;
            color: black;
            padding: 2rem;
            border-radius: 1rem;
            text-align: center;
        }
        .game-over-content button {
            background-color: #2b7a2b;
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 0.5rem;
            font-size: 1.1rem;
            cursor: pointer;
            margin-top: 1rem;
        }
        .game-over-content button:hover {
            background-color: #1f5f1f;
        }
        .instructions {
            position: fixed;
            bottom: 1rem;
            left: 1rem;
            font-size: 0.9rem;
            z-index: 80;
        }
        .back-button {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            background-color: #1a73e8;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            text-decoration: none;
            z-index: 80;
        }
        .back-button:hover {
            background-color: #1557b0;
        }
    </style>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const ZombieGame = () => {
            const [score, setScore] = React.useState(0);
            const [lives, setLives] = React.useState(3);
            const [gameOver, setGameOver] = React.useState(false);
            const [zombies, setZombies] = React.useState([]);
            const [currentQuestion, setCurrentQuestion] = React.useState(null);
            const [answerGenerated, setAnswerGenerated] = React.useState(false);
            const [questionCount, setQuestionCount] = React.useState(0);
            const [level, setLevel] = React.useState(1);

            const QUESTIONS_PER_LEVEL = 10;
            const POSITION_ZONES = [
                { min: 5, max: 20 },
                { min: 25, max: 35 },
                { min: 40, max: 50 },
                { min: 55, max: 65 },
                { min: 70, max: 80 },
                { min: 85, max: 95 }
            ];

            const wordBank = [
                ['memerlukan', 'éœ€è¦'],
                ['lauk-pauk', 'èœè‚´'],
                ['kegemaran', 'å–œæ¬¢çš„'],
                ['bergerak', 'ç§»åŠ¨'],
                ['pengetahuan', 'çŸ¥è¯†'],
                ['penyabar', 'æœ‰è€å¿ƒçš„'],
                ['merawat', 'æ²»ç–—'],
                ['panggil', 'å«'],
                ['lemau', 'çš®äº†'],
                ['gopoh', 'åŒ†å¿™']
            ];

            const getRandomPosition = (usedPositions) => {
                const availableZones = POSITION_ZONES.filter((_, index) => 
                    !usedPositions.includes(index)
                );
                if (availableZones.length === 0) return null;
                
                const randomZone = availableZones[Math.floor(Math.random() * availableZones.length)];
                const position = Math.random() * (randomZone.max - randomZone.min) + randomZone.min;
                return {
                    position,
                    zoneIndex: POSITION_ZONES.indexOf(randomZone)
                };
            };

            const generateQuestion = () => {
                const randomPair = wordBank[Math.floor(Math.random() * wordBank.length)];
                setAnswerGenerated(false);
                return {
                    malay: randomPair[0],
                    chinese: randomPair[1]
                };
            };

            const generateZombie = (forceAnswer = false) => {
                const usedPositions = zombies.map(z => z.zoneIndex);
                const positionData = getRandomPosition(usedPositions);
                
                if (!positionData) return null;

                if (forceAnswer || (!answerGenerated && currentQuestion)) {
                    setAnswerGenerated(true);
                    return {
                        id: Date.now(),
                        word: currentQuestion.malay,
                        isAnswer: true,
                        position: positionData.position,
                        zoneIndex: positionData.zoneIndex,
                        top: -50
                    };
                } else {
                    let randomPair;
                    do {
                        randomPair = wordBank[Math.floor(Math.random() * wordBank.length)];
                    } while (currentQuestion && randomPair[0] === currentQuestion.malay);
                    
                    return {
                        id: Date.now(),
                        word: randomPair[0],
                        isAnswer: false,
                        position: positionData.position,
                        zoneIndex: positionData.zoneIndex,
                        top: -50
                    };
                }
            };

            const startNewLevel = () => {
                setZombies([]);
                setAnswerGenerated(false);
                setCurrentQuestion(generateQuestion());
            };

            const startNewGame = () => {
                setScore(0);
                setLives(3);
                setGameOver(false);
                setQuestionCount(0);
                setLevel(1);
                startNewLevel();
            };

            React.useEffect(() => {
                startNewGame();
            }, []);

            React.useEffect(() => {
                if (gameOver) return;
                
                if (!answerGenerated && currentQuestion) {
                    const zombie = generateZombie(true);
                    if (zombie) {
                        setZombies(prev => [...prev, zombie]);
                    }
                }
                
                const interval = setInterval(() => {
                    const zombie = generateZombie();
                    if (zombie) {
                        setZombies(prev => [...prev, zombie]);
                    }
                }, 2000);

                return () => clearInterval(interval);
            }, [gameOver, currentQuestion, answerGenerated]);

            React.useEffect(() => {
                if (gameOver) return;

                const moveInterval = setInterval(() => {
                    setZombies(prev => {
                        const newZombies = prev.map(zombie => ({
                            ...zombie,
                            top: zombie.top + 1.5
                        })).filter(zombie => zombie.top < window.innerHeight - 100);

                        if (prev.length > newZombies.length) {
                            setLives(lives => {
                                const newLives = lives - 1;
                                if (newLives <= 0) {
                                    setGameOver(true);
                                }
                                return newLives;
                            });
                        }

                        return newZombies;
                    });
                }, 50);

                return () => clearInterval(moveInterval);
            }, [gameOver]);

            const handleClick = (zombie) => {
                if (gameOver) return;

                if (zombie.isAnswer) {
                    setScore(score + 1);
                    setQuestionCount(prev => {
                        const newCount = prev + 1;
                        if (newCount >= QUESTIONS_PER_LEVEL) {
                            setLevel(level + 1);
                            setQuestionCount(0);
                            startNewLevel();
                        } else {
                            setCurrentQuestion(generateQuestion());
                        }
                        return newCount;
                    });
                } else {
                    setLives(lives => {
                        const newLives = lives - 1;
                        if (newLives <= 0) {
                            setGameOver(true);
                        }
                        return newLives;
                    });
                }
                
                setZombies(prev => prev.filter(z => z.id !== zombie.id));
            };

            return (
                <div className="game-container">
                    <div className="status-bar">
                        <div className="status-left">
                            <div>ç¬¬ {level} å…³</div>
                            <div>é¢˜ç›®: {questionCount}/{QUESTIONS_PER_LEVEL}</div>
                            <div>åˆ†æ•°: {score}</div>
                        </div>
                        <div className="lives">ç”Ÿå‘½å€¼: {'â¤ï¸'.repeat(lives)}</div>
                    </div>

                    <div className="question">
                        è¯·é€‰æ‹©"{currentQuestion?.chinese}"çš„é©¬æ¥æ–‡
                    </div>

                    {zombies.map(zombie => (
                        <div
                            key={zombie.id}
                            className="zombie"
                            style={{
                                left: `${zombie.position}%`,
                                top: zombie.top,
                            }}
                            onClick={() => handleClick(zombie)}
                        >
                            <div className="zombie-word">{zombie.word}</div>
                            <div className="zombie-emoji">ğŸ§Ÿ</div>
                        </div>
                    ))}

                    {gameOver && (
                        <div className="game-over">
                            <div className="game-over-content">
                                <h2>æ¸¸æˆç»“æŸ!</h2>
                                <p>æœ€ç»ˆå¾—åˆ†: {score}</p>
                                <p>è¾¾åˆ°ç¬¬ {level} å…³</p>
                                <button onClick={startNewGame}>
                                    é‡æ–°å¼€å§‹
                                </button>
                            </div>
                        </div>
                    )}

                    <div className="instructions">
                        <p>ç‚¹å‡»å¯¹åº”é¢˜ç›®çš„é©¬æ¥æ–‡åƒµå°¸å¾—åˆ†</p>
                        <p>æ¯å…³éœ€ç­”å¯¹10é¢˜æ‰èƒ½è¿›å…¥ä¸‹ä¸€å…³</p>
                        <p>ç‚¹é”™æˆ–è®©åƒµå°¸è§¦åº•éƒ½ä¼šæ‰£ç”Ÿå‘½å€¼</p>
                        <p>ä¸‰æ¬¡å¤±è¯¯åæ¸¸æˆç»“æŸ</p>
                    </div>

                    <a href="../" className="back-button">è¿”å›ä¸»é¡µ</a>
                </div>
            );
        };

        ReactDOM.render(<ZombieGame />, document.getElementById('root'));
    </script>
</body>
</html>
